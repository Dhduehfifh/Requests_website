
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>GuildHub · 冒险者工会式委托平台（Demo）</title>
  <link rel="stylesheet" href="styles.css"/>
  <script defer src="app.js"></script>
  <script defer>
    document.addEventListener('DOMContentLoaded', ()=>{
      header('index.html');
      renderAdbar();
      ensureDateLimit('expiresAt');
      const activeCountEl = document.getElementById('activeCount');

      const list = requests().sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
      document.getElementById('reqList').innerHTML = list.map(renderRequestCard).join('') || `<div class="empty">暂无委托</div>`;
      activeCountEl.textContent = activeRequestsCount(currentUser().id);

      document.getElementById('newReqForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        data.budget = parseFloat(data.budget || 0);
        data.anonymous = !!data.anonymous;
        createRequest(data);
      });
    });
  </script>
</head>
<body>
  <div id="app-header"></div>
  <div class="container grid two-col">
    <div>
      <div class="adbar">
        <div class="ad-track"></div>
      </div>
      <div style="height:12px"></div>
      <div class="card">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="section-title">发布委托</div>
          <span class="badge">你当前激活委托：<span id="activeCount">0</span>/3</span>
          <a class="btn small ghost" href="tutorial.html">链接卡片教程</a>
        </div>
        <form id="newReqForm">
          <div class="label">标题</div>
          <input class="input" name="title" required placeholder="例如：做一个Logo 或 修复小程序支付问题"/>
          <div class="label">描述（包含 URL 将自动生成卡片）</div>
          <textarea name="description" required placeholder="在此描述你的需求。可直接粘贴链接：https://example.com/spec ..."></textarea>
          <div class="grid" style="grid-template-columns:1fr 1fr 1fr; gap:10px">
            <div>
              <div class="label">预算（¥）</div>
              <input class="input" name="budget" type="number" min="0" step="1" required/>
            </div>
            <div>
              <div class="label">截止日期（≤ 7 天）</div>
              <input id="expiresAt" class="input date" name="expiresAt" type="date" required/>
            </div>
            <div>
              <div class="label">匿名发布</div>
              <label><input type="checkbox" name="anonymous"/> 使用匿名</label>
            </div>
          </div>
          <div style="height:10px"></div>
          <button class="btn primary">发布</button>
        </form>
      </div>
      <div style="height:12px"></div>
      <div class="section-title">最新委托</div>
      <div id="reqList" class="grid"></div>
    </div>
    <div>
      <div class="card">
        <div class="section-title">公开问答（不允许匿名）</div>
        <div class="help small-note">有问题先公开问，谈妥再与雇主私信细节。</div>
        <div style="height:8px"></div>
        <a class="btn small" href="qna.html">进入问答</a>
      </div>
      <div style="height:12px"></div>
      <div class="card">
        <div class="section-title">规则</div>
        <ul class="help">
          <li>每位用户最多 3 个进行中的委托（完成或过期后释放额度）。</li>
          <li>委托最长期限为 7 天。</li>
          <li>公开问答不得匿名；委托可选择匿名。</li>
          <li>达成合作后可在“私信”页面沟通价格与细节。</li>
          <li>完成后双方可互评，评分显示在主页。</li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container footer">© Demo only — 数据存储于浏览器 localStorage</div>
</body>
</html>
